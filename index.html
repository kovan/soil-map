<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Soil Organic Matter Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        #map {
            width: 100%;
            height: 100vh;
        }

        .info {
            padding: 10px 14px;
            background: white;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border-radius: 8px;
            min-width: 200px;
        }

        .info h4 {
            margin: 0 0 8px;
            color: #333;
            font-size: 16px;
        }

        .info p {
            margin: 4px 0;
            color: #666;
            font-size: 14px;
        }

        .info .country-name {
            font-size: 18px;
            font-weight: 600;
            color: #222;
        }

        .info .percentage {
            font-size: 24px;
            font-weight: 700;
            color: #5D4037;
        }

        .legend {
            background: rgba(255,255,255,0.95);
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            line-height: 1.6;
        }

        .legend h4 {
            margin: 0 0 10px;
            font-size: 14px;
            color: #333;
        }

        .legend i {
            width: 24px;
            height: 16px;
            float: left;
            margin-right: 8px;
            border-radius: 2px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
            font-size: 12px;
            color: #555;
        }

        .title-control {
            background: rgba(255,255,255,0.95);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            text-align: center;
        }

        .title-control h1 {
            font-size: 20px;
            color: #333;
            margin: 0;
        }

        .title-control p {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Soil Organic Carbon data by country (% in topsoil, approximate averages)
        // Sources: FAO SOLAW, ISRIC SoilGrids, scientific literature
        const soilOrganicData = {
            // Europe
            "RUS": 2.8, "DEU": 2.1, "FRA": 1.9, "GBR": 3.2, "ITA": 1.6,
            "ESP": 1.4, "POL": 1.8, "UKR": 3.1, "ROU": 2.0, "NLD": 4.2,
            "BEL": 2.5, "CZE": 1.9, "GRC": 1.3, "PRT": 1.5, "SWE": 4.8,
            "HUN": 2.2, "AUT": 3.0, "CHE": 3.5, "BGR": 1.8, "DNK": 2.8,
            "FIN": 5.2, "SVK": 2.0, "NOR": 4.5, "IRL": 4.8, "HRV": 2.1,
            "BIH": 2.3, "ALB": 1.7, "LTU": 2.4, "SVN": 3.2, "LVA": 2.6,
            "EST": 3.0, "MKD": 1.9, "LUX": 2.3, "MNE": 2.5, "ISL": 6.5,
            "SRB": 2.1, "BLR": 2.5, "MDA": 2.8,

            // Asia
            "CHN": 1.5, "IND": 0.6, "JPN": 2.8, "IDN": 2.2, "PAK": 0.5,
            "BGD": 1.1, "VNM": 1.8, "THA": 1.2, "MMR": 1.5, "KOR": 2.0,
            "MYS": 2.5, "NPL": 1.4, "AFG": 0.7, "IRQ": 0.6, "SAU": 0.3,
            "UZB": 0.8, "YEM": 0.4, "PRK": 1.6, "SYR": 0.8, "KAZ": 1.8,
            "AZE": 1.5, "ARE": 0.2, "TJK": 1.2, "ISR": 0.9, "LAO": 1.6,
            "KGZ": 2.5, "TKM": 0.6, "GEO": 2.8, "OMN": 0.3, "MNG": 1.4,
            "ARM": 2.2, "QAT": 0.2, "BHR": 0.2, "KWT": 0.3, "LBN": 1.2,
            "JOR": 0.5, "PHL": 1.8, "KHM": 1.3, "LKA": 1.5, "BTN": 3.2,
            "TWN": 1.9, "TLS": 1.4,

            // Africa
            "NGA": 1.0, "ETH": 1.8, "EGY": 0.5, "COD": 2.2, "ZAF": 1.2,
            "TZA": 1.5, "KEN": 1.6, "SDN": 0.4, "DZA": 0.7, "MAR": 1.1,
            "UGA": 2.0, "GHA": 1.4, "MOZ": 1.1, "MDG": 2.5, "CMR": 2.0,
            "CIV": 1.3, "NER": 0.3, "BFA": 0.5, "MLI": 0.4, "MWI": 1.5,
            "ZMB": 1.2, "SEN": 0.6, "TCD": 0.5, "SOM": 0.4, "ZWE": 1.0,
            "GIN": 1.6, "RWA": 2.8, "BEN": 0.9, "BDI": 2.2, "TUN": 0.9,
            "SSD": 1.4, "TGO": 1.0, "SLE": 1.5, "LBY": 0.3, "CAF": 1.8,
            "MRT": 0.3, "ERI": 0.6, "NAM": 0.5, "BWA": 0.6, "GAB": 2.5,
            "LSO": 1.8, "GMB": 0.7, "GNB": 1.2, "COG": 2.3, "SWZ": 1.4,
            "AGO": 1.3, "LBR": 1.8, "GNQ": 2.4, "DJI": 0.3,

            // North America
            "USA": 2.0, "CAN": 3.5, "MEX": 1.6, "GTM": 2.2, "CUB": 2.0,
            "HTI": 1.2, "DOM": 1.8, "HND": 2.0, "NIC": 2.2, "SLV": 1.8,
            "CRI": 3.5, "PAN": 2.8, "JAM": 2.5, "TTO": 2.2, "BHS": 1.5,
            "BLZ": 2.5, "BRB": 1.8,

            // South America
            "BRA": 1.8, "ARG": 2.5, "COL": 3.2, "PER": 2.0, "VEN": 1.8,
            "CHL": 2.8, "ECU": 3.5, "BOL": 1.5, "PRY": 1.4, "URY": 3.2,
            "GUY": 2.8, "SUR": 2.5, "GUF": 3.0,

            // Oceania
            "AUS": 1.2, "PNG": 3.5, "NZL": 4.5, "FJI": 3.0, "SLB": 2.8,
            "VUT": 3.2, "NCL": 2.5,

            // Additional
            "CYP": 1.3, "XKX": 2.0
        };

        // Initialize map
        const map = L.map('map', {
            center: [20, 0],
            zoom: 2,
            minZoom: 2,
            maxZoom: 8,
            worldCopyJump: true
        });

        // Add tile layer (simple gray basemap)
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        }).addTo(map);

        // Color scale function
        function getColor(value) {
            if (value === null || value === undefined) return '#ccc';
            return value > 5   ? '#3E2723' :
                   value > 4   ? '#4E342E' :
                   value > 3   ? '#5D4037' :
                   value > 2.5 ? '#6D4C41' :
                   value > 2   ? '#795548' :
                   value > 1.5 ? '#8D6E63' :
                   value > 1   ? '#A1887F' :
                   value > 0.5 ? '#BCAAA4' :
                   value > 0   ? '#D7CCC8' :
                                 '#EFEBE9';
        }

        // Style function for GeoJSON
        function style(feature) {
            const countryCode = feature.properties['ISO3166-1-Alpha-3'];
            const value = soilOrganicData[countryCode];
            return {
                fillColor: getColor(value),
                weight: 1,
                opacity: 1,
                color: '#fff',
                fillOpacity: 0.85
            };
        }

        // Info control
        const info = L.control({ position: 'topright' });

        info.onAdd = function(map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };

        info.update = function(props) {
            if (!props) {
                this._div.innerHTML = '<h4>Soil Organic Matter</h4><p>Hover over a country</p>';
                return;
            }
            const countryCode = props['ISO3166-1-Alpha-3'];
            const countryName = props.name;
            const value = soilOrganicData[countryCode];

            this._div.innerHTML = `
                <h4>Soil Organic Matter</h4>
                <p class="country-name">${countryName}</p>
                ${value !== undefined
                    ? `<p class="percentage">${value.toFixed(1)}%</p><p>of topsoil content</p>`
                    : '<p style="color:#999">No data available</p>'}
            `;
        };

        info.addTo(map);

        // Title control
        const title = L.control({ position: 'topleft' });

        title.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'title-control');
            div.innerHTML = `
                <h1>World Soil Organic Matter</h1>
                <p>Average organic percentage in topsoil by country</p>
            `;
            return div;
        };

        title.addTo(map);

        // Legend control
        const legend = L.control({ position: 'bottomright' });

        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'legend');
            const grades = [0, 0.5, 1, 1.5, 2, 2.5, 3, 4, 5];

            div.innerHTML = '<h4>Organic Matter %</h4>';

            for (let i = grades.length - 1; i >= 0; i--) {
                const from = grades[i];
                const to = grades[i + 1];
                div.innerHTML += `
                    <div class="legend-item">
                        <i style="background:${getColor(from + 0.1)}"></i>
                        ${from}${to ? '&ndash;' + to : '+'}%
                    </div>
                `;
            }

            div.innerHTML += `
                <div class="legend-item">
                    <i style="background:#ccc"></i>
                    No data
                </div>
            `;

            return div;
        };

        legend.addTo(map);

        // Interaction functions
        let geojsonLayer;

        function highlightFeature(e) {
            const layer = e.target;
            layer.setStyle({
                weight: 2,
                color: '#333',
                fillOpacity: 0.95
            });
            layer.bringToFront();
            info.update(layer.feature.properties);
        }

        function resetHighlight(e) {
            geojsonLayer.resetStyle(e.target);
            info.update();
        }

        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds(), { padding: [50, 50] });
        }

        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }

        // Load GeoJSON data
        fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
            .then(response => response.json())
            .then(data => {
                geojsonLayer = L.geoJson(data, {
                    style: style,
                    onEachFeature: onEachFeature
                }).addTo(map);
            })
            .catch(error => {
                console.error('Error loading GeoJSON:', error);
                // Fallback message
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.2);';
                errorDiv.innerHTML = '<h3>Error loading map data</h3><p>Please check your internet connection and refresh.</p>';
                document.body.appendChild(errorDiv);
            });
    </script>
</body>
</html>
